<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Document</title>
</head>
<body>

        <!-- navbar -->
        <div class="navbar">
            <div class="logo">
            <img src="/backend/public/f1logo.png" alt="logof1">
            </div>
            <div class="links">
            <a href="" class="opciones">Circuitos</a>
            <a href="" class="opciones">Galeria</a>
            <a href="" class="opciones">Galeria</a>
            </div>
        </div>
    
    <!-- Titulo de la pagina -->
    <div class="conteiner">
        <nav>
            <button class="button-title">CIRCUITO
            <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm4.28 10.28a.75.75 0 000-1.06l-3-3a.75.75 0 10-1.06 1.06l1.72 1.72H8.25a.75.75 0 000 1.5h5.69l-1.72 1.72a.75.75 0 101.06 1.06l3-3z"
                clip-rule="evenodd"
            ></path>
            </svg>
            </button>
        </nav>
    </div>

    <!-- Contenedor para la tabla y el botón -->
    <div class="conteiner1">
        <div class="left-panel">
            <table id="infoTable" class="table1 left-table">
                <thead class="thead1">
                    <tr class="tr1">
                        <th class="th1">Nombre</th>
                    </tr>
                </thead>
                <tbody class="tbody1">
                    <!-- Aquí se agregarán las filas -->
                </tbody>
            </table>
        </div>
    

        <!-- -----------------------------------      Popup      ----------------------------------------- -->
        <div id="popup">
            <div class="popupBox">
                <h3>Agregar Nueva Pista</h3>

                <label for="new_namePista">Nombre:</label>
                <input type="text" id="new_namePista" placeholder="Ingresa nombre de nueva pista">

                <label for="new_descriptionPista">Descripción:</label>
                <input type="text" id="new_descriptionPista" placeholder="Ingresa una pequeña descripción">

                <label for="new_imgPista">Imagen (URL):</label>
                <input type="text" id="new_imgPista" placeholder="URL de la imagen de la pista">

                <label for="new_countryImgPista">Pais:</label>
                <input type="text" id="new_countryImgPista" placeholder="URL de la imagen del pais">

                <label for="new_firstGrandPrixPista">Primer Gran Premio:</label>
                <input type="number" id="new_firstGrandPrixPista" placeholder="Año del primer Gran Premio">

                <label for="new_numberPista">Numero de vueltas:</label>
                <input type="number" id="new_numberPista" placeholder="Numero de vueltas de la carrera">

                <label for="new_circuitLengthPista">Longitud del circuito (km):</label>
                <input type="number" id="new_circuitLengthPista" placeholder="Longitud de la pista en km">

                <label for="new_raceDistancePista">Distancia de carrera (km):</label>
                <input type="number" id="new_raceDistancePista" placeholder="Distancia total de la carrera">

                <button onclick="addInfo()">Agregar</button>
                <button onclick="closePopup()">Cerrar</button>
            </div>
        </div>


        <!-- -----------------------------------    Popup2     ----------------------------------------- -->

        <div id="popup2">
            <div class="popupBox">
                <h3>Editar Pista</h3>
        
                <!-- Selección del ID de la pista -->
                <label for="select_pista">Seleccionar Pista:</label>
                <select id="select_pista" onchange="loadPistaDetails()">
                    <option value="">Seleccione una pista</option>
                    <!-- Aquí se generarán las opciones dinámicamente -->
                </select><br>
        
                <label for="edit_namePista">Nombre:</label>
                <input type="text" id="edit_namePista" placeholder="Nombre de la pista">
        
                <label for="edit_descriptionPista">Descripción:</label>
                <input type="text" id="edit_descriptionPista" placeholder="Descripción de la pista">
        
                <label for="edit_imgPista">Imagen (URL):</label>
                <input type="text" id="edit_imgPista" placeholder="URL de la imagen de la pista">
        
                <label for="edit_countryImgPista">Pais:</label>
                <input type="text" id="edit_countryImgPista" placeholder="URL de la imagen del país">
        
                <label for="edit_firstGrandPrixPista">Primer Gran Premio:</label>
                <input type="number" id="edit_firstGrandPrixPista" placeholder="Año del primer Gran Premio">
        
                <label for="edit_numberPista">Número de vueltas:</label>
                <input type="number" id="edit_numberPista" placeholder="Número de vueltas de la carrera">
        
                <label for="edit_circuitLengthPista">Longitud del circuito (km):</label>
                <input type="number" id="edit_circuitLengthPista" placeholder="Longitud de la pista en km">
        
                <label for="edit_raceDistancePista">Distancia de carrera (km):</label>
                <input type="number" id="edit_raceDistancePista" placeholder="Distancia total de la carrera">
        
                <button onclick="saveEdits()">Guardar Cambios</button>
                <button onclick="closePopup2()">Cerrar</button>
            </div>
        </div>


     

        <!--   --------------------  WEB COMPONENT  ---------------------------------------    -->
        <div class="right-panel">
            <!-- Contenedores en el panel derecho (con la clase específica right-container) -->
            <div class="right-container">
                <div class="renglon1">
                    <div class="info1">
                        <p class="bandera" id="show_countryImgPista"></p>
                        <p class="nombrepista" id="show_new_namePista"></p>
                    </div>
                    <div class="info2">
                        <p id="show_descriptionPista"></p>
                    </div>
                </div>
            <div class="renglon2">
                <div class="info3"></div>
                <div class="info4">
                    <div class="info-item" id="show_firstGrandPrixPista"></div>
                    <div class="info-item" id="show_numberPista"></div>
                    <div class="info-item" id="show_circuitLengthPista"></div>
                    <div class="info-item" id="show_raceDistancePista"></div>
                </div>
            </div>
            </div>

            <div class="wrapper">
                <input type="checkbox" />
                <div class="btn"></div>
                <div class="tooltip">
                    <button class="addPista" onclick="openPopup()" ><svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 20 20" height="24" fill="none" ><g stroke-width="1.5" stroke-linecap="round" stroke="white"><circle r="7.5" cy="10" cx="10"></circle><path d="m9.99998 7.5v5"></path><path d="m7.5 9.99998h5"></path></g></svg></button>

                    <button class="editPista" onclick="openPopup2()"><svg
                        class="css-i6dzq1"
                        stroke-linejoin="round"
                        stroke-linecap="round"
                        fill="none"
                        stroke-width="2"
                        stroke="currentColor"
                        height="24"
                        width="24"
                        viewBox="0 0 24 24"
                      >
                        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                      </svg></button>
                </div>
            </div>





    <!-- JAVA --------------------------------------------------------------------------------     -->

    <script>
        // URL del JSON Server
        const API_URL = "http://localhost:3000/pistas";
    
        // Función para abrir el popup
        function openPopup() {
            document.getElementById('popup').style.display = 'flex';
        }
    
        // Función para cerrar el popup
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }
    
        // Función para agregar una pista al JSON Server y actualizar la tabla izquierda
        async function addInfo() {
            const nombre = document.getElementById('new_namePista').value;
            const descripcion = document.getElementById('new_descriptionPista').value;
            const img = document.getElementById('new_imgPista').value;
            const pais = document.getElementById('new_countryImgPista').value;
            const primerGP = document.getElementById('new_firstGrandPrixPista').value;
            const numeroVueltas = document.getElementById('new_numberPista').value;
            const longitud = document.getElementById('new_circuitLengthPista').value;
            const distancia = document.getElementById('new_raceDistancePista').value;
    
            const pista = { nombre, descripcion, img, pais, primerGP, numeroVueltas, longitud, distancia };
    
            try {
                await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(pista)
                });
                loadLeftTable();
                closePopup();
            } catch (error) {
                console.error("Error al agregar la pista:", error);
                alert("No se pudo agregar la pista");
            }
        }
    
        // Cargar la tabla izquierda con solo los nombres
        async function loadLeftTable() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Error al cargar datos");

                const pistas = await response.json();
                const tableBody = document.querySelector('.left-table tbody');
                tableBody.innerHTML = ""; // Limpiar la tabla antes de agregar las filas


                pistas.forEach(pista => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${pista.nombre}</td>`;
                    row.onclick = () => showDetails(pista);
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Error:", error);
                alert("No se pudieron cargar las pistas");
            }
        }

    
        // Mostrar detalles en la tabla derecha cuando se selecciona una pista
        function showDetails(pista) {
            const table = document.querySelector('.right-container');
            table.innerHTML = 
            `
            <button onclick="deletePista('${pista.id}')" class="removePista"><svg viewBox="0 0 448 512" class="svgIcon"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path></svg></button>
            <div class="renglon1">
                <div class="info1">
                    <img class="bandera" src="${pista.pais}" >
                    <p class= "nombrepista">${pista.nombre}</p>
                </div>
                <div class="info2">
                    <p>${pista.descripcion}</p>
                </div>
            </div>
            
            <div class="renglon2">
                <div class="info3">
                    <img src="${pista.img}" width="400px" height="300px">
                </div>
                <div class="info4">
                    <div class="info-item">
                        <span class="grandprix">Primer GP
                        </span>
                        <h2 class="valor">${pista.primerGP}</h2>
                        </div>
                    <div class="info-item">
                        <span class="vueltas">vueltas
                        </span>
                        <h2 class="valor">${pista.numeroVueltas}</h2>
                        </div>
                    <div class="info-item">
                        <span class="longitud">longitud
                        </span>
                        <h2 class="valor">${pista.longitud}</h2>
                        </div>
                    <div class="info-item">
                        <span class="distancia">distancia
                        </span>
                        <h2 class="valor">${pista.distancia}</h2>
                        </div>
                </div>

            </div>
                
            `;
        }
    
        // Cargar la tabla izquierda al cargar la página
        window.onload = function () {
            loadLeftTable();
        };


        async function deletePista(id) {
            console.log("ID a eliminar:", id); // Verifica que el ID se imprime correctamente
            if (confirm("Estas seguro de que deseas eliminar esta pista?")) {
                try {
                    await fetch(`${API_URL}/${id}`, { method: "DELETE" });
                    loadLeftTable(); // Recargar la tabla izquierda
                    document.querySelector('.right-table').innerHTML = ''; // Limpiar detalles
                } catch (error) {
                    console.error("Error al eliminar la pista:", error);
                    alert("No se pudo eliminar la pista");
                }
            }
        }





        // ----------------------------- POP UP 2 --------------------------------


        // Función para cerrar el Popup de Edición
        function closePopup2() {
            document.getElementById("popup2").style.display = "none";
        }

        // Función para cargar las opciones en el select
        async function loadPistas() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Error al cargar las pistas");

                const pistas = await response.json();
                const select = document.getElementById("select_pista");
                select.innerHTML = '<option value="">Seleccione una pista</option>'; // Limpiar opciones previas

                pistas.forEach(pista => {
                    const option = document.createElement("option");
                    option.value = pista.id;
                    option.textContent = pista.nombre; // Asegúrate de usar el nombre correcto del campo
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Error:", error);
                alert("No se pudieron cargar las pistas");
            }
        }

        // Función para abrir el Popup de Edición
        function openPopup2() {
            document.getElementById("popup2").style.display = "flex";
            loadPistas(); // Cargar las pistas cuando se abre el popup
        }


        // Cargar los detalles de la pista seleccionada
        async function loadPistaDetails() {
            const select = document.getElementById("select_pista");
            const pistaId = select.value;

            if (pistaId) {
                try {
                    const response = await fetch(`${API_URL}/${pistaId}`);
                    if (!response.ok) throw new Error("No se pudo obtener la pista");

                    const pista = await response.json();

                    document.getElementById("edit_namePista").value = pista.nombre;
                    document.getElementById("edit_descriptionPista").value = pista.descripcion;
                    document.getElementById("edit_imgPista").value = pista.img;
                    document.getElementById("edit_countryImgPista").value = pista.pais;
                    document.getElementById("edit_firstGrandPrixPista").value = pista.primerGP;
                    document.getElementById("edit_numberPista").value = pista.numeroVueltas;
                    document.getElementById("edit_circuitLengthPista").value = pista.longitud;
                    document.getElementById("edit_raceDistancePista").value = pista.distancia;
                } catch (error) {
                    console.error("Error al cargar detalles de la pista:", error);
                    alert("No se pudieron cargar los detalles de la pista.");
                }
            }
        }


        // Función para guardar los cambios
        async function saveEdits() {
            const pistaId = document.getElementById("select_pista").value;

            if (pistaId) {
                const updatedPista = {
                    nombre: document.getElementById("edit_namePista").value,
                    descripcion: document.getElementById("edit_descriptionPista").value,
                    img: document.getElementById("edit_imgPista").value,
                    pais: document.getElementById("edit_countryImgPista").value,
                    primerGP: document.getElementById("edit_firstGrandPrixPista").value,
                    numeroVueltas: document.getElementById("edit_numberPista").value,
                    longitud: document.getElementById("edit_circuitLengthPista").value,
                    distancia: document.getElementById("edit_raceDistancePista").value
                };

                try {
                    const response = await fetch(`${API_URL}/${pistaId}`, {
                        method: "PUT", // También podrías usar PATCH si solo actualizas algunos campos
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(updatedPista)
                    });

                    if (!response.ok) throw new Error("No se pudo actualizar la pista");

                    alert("Pista actualizada con éxito");
                    closePopup2();
                    loadLeftTable(); // Recargar la tabla izquierda con los cambios
                } catch (error) {
                    console.error("Error al actualizar la pista:", error);
                    alert("No se pudieron guardar los cambios.");
                }
            }
        }

    </script>
    
</body>
</html>
